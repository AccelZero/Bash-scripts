Скрипт автоматической развертки Bitrix проектов
   
Для работы скрипта нужно предварительно создать директории:  
/root/autoproject/  
/home/bitrix/  
/etc/nginx/bx/site_avaliable/  
/etc/nginx/bx/site_enabled/  
/etc/httpd/bx/conf/  
А также настроить конфиги nginx и apache под директории, что написаны выше.   
Скрипт желательно положить в /root/autoproject/, но не обязательно.
   
Скрипт состоит из 3 частей:  
autoproject_deploy.sh - собственно создает сам Bitrix проект, а так же его dev версию, например cat.sobaka.ru/devcat.sobaka.ru:  
создает директории под проект  
Создает конфиги nginx и apache  
Создает символьные ссылки конфигов nginx   
Создает новые БД и юзера в БД  
Записывает данные от нового юзера в БД в /root/autoproject/.db_pass
   
autoproject_testconfig.sh - проверяет конфиги nginx и apache
   
autoproject_reloadconfig.sh - выполняет релоад nginx и apache для перечитывания конфигов
   
Создаем проект с помощью autoproject_deploy.sh  
Что бы создать Bitrix проект с помощью данного скрипта, нужно запустить его с переменными вида:  
./autoproject_deploy.sh "Имя проекта" "Полный путь до директории проекта" "Порт"
   
"Имя проекта" - нужно указать название проекта, например cat.sobaka.ru, dev версию проекта указывать нигде не нужно.  
"Полный путь до директории проекта" - нужно указать полный путь, начиная от корня, например /home/bitrix/www21/cat.sobaka.ru, путь до dev версии проекта опять же указывать не нужно.  
"Порт" - нужно указать свободный порт, который будет использоваться Bitrix проектом. Учитываем, что под dev версию тоже нужен будет порт, поэтому скрипт берет указанный в данной переменной порт и следующий идущий за ним. Например, если указывается 8320, то под проекты будут взяты 8320 и 8321.
   
Пример заполненной команды:  
./autoproject_deploy.sh "cat.sobaka.ru" "/home/bitrix/www21/cat.sobaka.ru" "8320"
   
После запуска команды выше скрипт напишет, что все успешно создано и спросит, нужно ли выдать права на директории проектов для дополнительных пользователей, нужно написать "Y", если нужно, и "N", если нет.  
В случае, если нужно - пишем "Y" на вопрос скрипта. Скрипт запросит у вас имя пользователя, которому нужно выдать права. Пишем имя пользователя, нажимаем enter, пишем следующие, и так пока не выдадим права всем пользователям, которым нужно их выдать. Ограничений на количество пользователей, которым можно выдать права - нет. Когда выдадим права всем, кому нужно, для выхода напишем "N".
   
   
Создаем проект с помощью autoproject_deploy.sh и дополнительной переменной "replace"  
Данный вариант создания проекта нужен для тех случаев, когда новый Bitrix проект нужно создать с именем старого проекта, который уже имеется на сервере. Если пытаться создать проект обычным вариантом при таких обстоятельствах, то скрипт будет выдавать ошибки, что конфиги nginx и apache с таким названием уже существуют.
   
Пример заполненной команды в этом случае будет выглядеть так:  
./autoproject_deploy.sh "cat.sobaka.ru" "/home/bitrix/www22/cat.sobaka.ru" "8322" "replace"
   
Полный путь до проекта  и порт все равно должны быть отличные от старых, иначе скрипт будет выдавать ошибки.  
При данном варианте скрипт автоматически за вас забэкапит старые конфиги nginx и apache старого проекта с таким же названием, а БД назовет с препиской текущего года, например cat_sobaka_ru_2022.  
В остальном создание проекта данным методом ничем не отличается от обычного метода.
   
   
Создаем проект без dev версии с помощью autoproject_singledeploy.sh   
Данный вариант нужен в том случае, если нужно развернуть проект без dev версии. Делает все тоже самое, что и обычный autoproject_deploy.sh, но разворачивает проект без dev версии. Данный вариант тоже можно запустить с доп. переменной "replace".   
   
   
Удаление проекта с помощью autoproject_projectdelete.sh   
Если вдруг случайно создали проект с неправильными данными или нужно удалить старый, уже не актуальный - это можно сделать с помощью autoproject_projectdelete.sh.   
   
Для запуска скрипта нужно ввести:   
./autoproject_projectdelete.sh "Имя проекта" "Полный путь до проекта"   
   
Обращаем внимание, что скрипт удаляет сразу обе версии проекта, например cat.sobaka.ru/devcat.sobaka.ru.  
